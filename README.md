# 🌻 Sunflower PDF Toolkit

PDFファイル処理Webアプリケーションです。直感的な操作で様々なPDF処理を行うことができます。

## ✨ 機能

### 📄 基本機能
- **PDF結合**: 複数のPDFファイルを好きな順番で結合
- **PDF分割**: 指定したページ範囲でPDFを分割
- **PDF回転**: 全ページまたは特定のページを回転
- **ページ削除**: 不要なページを削除
- **PDF挿入**: 既存のPDFファイルに別のPDFを指定位置で挿入
- **透かし追加**: PNG、JPG、JPEG、GIF、BMP、PDF画像を透かしとして追加
- **ファイル名変更（電帳法対応）**: 電子帳簿保存法に準拠したファイル名生成

### 🎯 特殊機能
- **リアルタイムPDFプレビュー**: PDF.jsを使用したブラウザ内プレビュー
- **ドラッグ&ドロップ**: ファイルの順序変更が可能
- **ページ範囲指定**: 柔軟なページ範囲指定（例: 1-3,5,7-9）
- **電子帳簿保存法対応**: 日付、取引先、金額を基にしたファイル名生成

## 🚀 インストール方法

### 1. 環境要件
- Python 3.7以上
- モダンWebブラウザ（Chrome、Firefox、Safari、Edge推奨）

### 2. セットアップ
```bash
# リポジトリをクローン
git clone https://github.com/[your-username]/sunflower_pdf_toolkit.git
cd sunflower_pdf_toolkit

# 仮想環境を作成して有効化
python -m venv venv

# Windows
venv\Scripts\activate

# macOS/Linux
source venv/bin/activate

# 依存関係のインストール
pip install -r requirements.txt

# アプリケーションの実行
python app.py
```

### 3. アクセス
ブラウザで `http://localhost:5000` にアクセス

## 📖 使用方法

### 基本的な流れ
1. 処理したい操作のボタンをクリック
2. 必要なファイルをアップロード
3. 設定を行い、処理を実行
4. リアルタイムプレビューで確認
5. 結果をダウンロード

### 各機能の詳細

#### 🔗 PDF結合
- 複数のPDFファイルを選択
- ドラッグ&ドロップまたは↑↓ボタンで順番を調整
- ✕ボタンで不要なファイルを削除

#### ✂️ PDF分割
- メインPDFファイルを選択
- ページ範囲を指定（例: `1-3,5,7-9`）
- 指定したページのみを含む新しいPDFを生成

#### 🔄 PDF回転
- メインPDFファイルを選択
- 回転角度を選択（90°、180°、270°）
- 全ページまたは特定ページを選択

#### 🗑️ ページ削除
- メインPDFファイルを選択
- 削除するページを指定（例: `1,3,5-7`）
- 指定したページ以外で新しいPDFを生成

#### 📄 PDF挿入
- メインPDFファイルを選択
- 挿入するPDFファイルを選択
- 挿入位置を数値で指定（1ベース）
- 例: 10ページのPDFで「5」を指定すると、4ページ目と5ページ目の間に挿入

#### 🏷️ 透かし追加
- メインPDFファイルを選択
- 透かし用ファイルを選択（PNG、JPG、JPEG、GIF、BMP、PDF）
- 自動的に透明度0.3で各ページに透かしを追加

#### 📊 ファイル名変更（電帳法対応）
- PDFファイルを選択
- 日付（例: 20250713）
- 取引先（例: ㈱ひまわり）
- 金額（例: 10000）
- 結合文字（例: -）
- 出力例: `20250713-㈱ひまわり-10000.pdf`

## 🛠️ 技術仕様

### 使用技術
- **Backend**: Flask (Python)
- **Frontend**: HTML5, CSS3, JavaScript
- **PDF処理**: PyPDF2
- **画像処理**: Pillow (PIL)
- **PDF生成**: ReportLab
- **PDFビューアー**: PDF.js 3.11.174
- **セキュリティ**: Werkzeug (secure_filename)

### 対応ファイル形式
- **PDF入力**: .pdf
- **透かし画像**: .png, .jpg, .jpeg, .gif, .bmp, .pdf

### APIエンドポイント
- `/` - メインページ
- `/upload` - ファイルアップロード・検証
- `/merge-pdfs` - PDF結合
- `/split-pdf` - PDF分割
- `/rotate-pdf` - PDF回転
- `/delete-pages` - ページ削除
- `/insert-pdf` - PDF挿入
- `/add-watermark` - 透かし追加
- `/edit-metadata` - メタデータ編集（電帳法対応）
- `/get-metadata` - メタデータ取得
- `/extract-text` - テキスト抽出

## 🏗️ プロジェクト構造
```
sunflower_pdf_toolkit/
├── app.py                 # メインアプリケーション（Flask）
├── templates/
│   └── index.html        # フロントエンドHTML（レスポンシブ対応）
├── uploads/              # 一時ファイル保存ディレクトリ
├── requirements.txt      # Python依存関係
├── README.md            # このファイル
├── .gitignore           # Git除外設定
└── venv/                # 仮想環境（gitignore済み）
```

## 🔧 開発者向け情報

### 主要な関数
- `is_valid_pdf()`: PDFファイル検証
- `is_valid_image()`: 画像ファイル検証
- `create_watermark_pdf_from_image()`: 画像から透かしPDF作成
- `parse_page_ranges()`: ページ範囲解析
- `generate_bookkeeping_filename()`: 電帳法対応ファイル名生成

### セキュリティ機能
- ファイル形式検証
- セキュアなファイル名生成
- 一時ファイル自動削除
- PDFファイル整合性チェック

### パフォーマンス特性
- メモリ効率的なPDF処理
- 大容量ファイル対応
- リアルタイムプレビュー
- 非同期ファイル処理

## ⚠️ 注意事項

### 制限事項
- アップロードファイルサイズ制限あり
- 処理時間は使用するPDFファイルサイズに依存
- 大量のページを含むPDFは処理に時間がかかる場合があります

### セキュリティ
- アップロードされたファイルは処理後に自動削除
- 一時ファイルは`uploads/`ディレクトリに保存
- セキュアなファイル名生成により、パストラバーサル攻撃を防止

### ブラウザ対応
- Chrome 90+（推奨）
- Firefox 88+
- Safari 14+
- Edge 90+

## 📱 レスポンシブデザイン

- デスクトップ: 3列レイアウト
- タブレット: 2列レイアウト
- スマートフォン: 1列レイアウト
- タッチ操作対応

## 🎨 デザインテーマ

- **カラーテーマ**: ひまわり（夏の空、温かい白）
- **アイコン**: 絵文字ベースの直感的UI
- **レイアウト**: カード型デザイン
- **UX**: ワンクリック操作、視覚的フィードバック

## 📞 サポート

バグ報告や機能要求は、GitHubのIssuesページでお知らせください。

---

💝 **開発者**: あなたの名前  
🌻 **プロジェクト**: Sunflower PDF Toolkit  
�� **最終更新**: 2025年1月
